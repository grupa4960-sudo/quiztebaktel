<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arena Zeus - Godlike Edition</title>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@900&family=Space+Grotesk:wght@300;700&family=Luckiest+Guy&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --gold: #ffd700; 
            --cyan: #00f2ff; 
            --dark: #050505;
        }

        body { 
            margin:0; 
            background: var(--dark); 
            color:#fff; 
            font-family: 'Space Grotesk', sans-serif; 
            overflow:hidden; 
            height: 100vh;
        }

        /* --- ANIMASI BACKGROUND (MENDUNG & PETIR) --- */
        .storm-bg {
            position: fixed; top:0; width:100%; height:100%;
            background: radial-gradient(circle, #101025 0%, #000 100%);
            z-index: -2;
        }

        .clouds {
            position: fixed; top:0; width:200%; height:100%;
            background: url('https://www.transparenttextures.com/patterns/dark-matter.png');
            opacity: 0.4; animation: moveClouds 60s linear infinite; z-index: -1;
        }

        @keyframes moveClouds { from {transform:translateX(0)} to {transform:translateX(-50%)} }

        .lightning {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: #fff; opacity:0; z-index: 10; pointer-events:none;
        }

        .strike { animation: lightningStrike 0.4s ease-out; }

        @keyframes lightningStrike { 
            0% {opacity:0} 10% {opacity:0.7; background:#fff} 20% {opacity:0} 
            25% {opacity:1; background:var(--cyan)} 100% {opacity:0} 
        }

        /* --- UI COMPONENTS --- */
        .container { display:flex; justify-content:center; align-items:center; height:100vh; position: relative; z-index: 11; }
        
        .card { 
            background: rgba(10, 10, 10, 0.8); 
            border: 2px solid rgba(255, 215, 0, 0.3); 
            padding: 40px; 
            border-radius: 20px; 
            text-align:center; 
            width: 90%;
            max-width: 400px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            backdrop-filter: blur(15px);
            position: relative;
        }

        h1 { 
            font-family: 'Cinzel', serif; 
            font-size: 2.5rem; 
            color: var(--gold); 
            margin: 0; 
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .glitch-text {
            color: var(--cyan);
            font-size: 0.9rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            font-weight: bold;
        }

        /* --- INPUT & BUTTON KEKINIAN --- */
        .box-row { display:flex; justify-content:center; gap:10px; margin:20px 0; }
        .letter-box { 
            width:45px; height:55px; border:2px solid var(--cyan); border-radius:8px;
            font-size:1.8rem; display:flex; align-items:center; justify-content:center;
            background: rgba(0,242,255,0.1); font-family: 'Luckiest Guy';
        }

        #timer { font-size: 3.5rem; font-family: 'Luckiest Guy'; color: #ff3333; text-shadow: 0 0 20px #ff0000; line-height: 1; }
        
        input { 
            width:100%; padding:15px; margin:10px 0; border-radius:12px; 
            border:1px solid rgba(255,215,0,0.3); background: rgba(255,255,255,0.05); 
            color:#fff; text-align:center; font-size:1.1rem; font-family: 'Space Grotesk';
            transition: 0.3s;
        }
        input:focus { outline: none; border-color: var(--cyan); background: rgba(0,242,255,0.05); }

        .btn { 
            width:100%; padding:18px; border:none; border-radius:12px; cursor:pointer; 
            font-family: 'Space Grotesk'; font-weight: 700; font-size:1.1rem; transition:0.3s;
            text-transform: uppercase; letter-spacing: 1px; margin-top: 10px;
        }

        .btn-main { background: var(--gold); color: #000; }
        .btn-main:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(255,215,0,0.3); }

        .btn-claim { background: #00ff88; color: #000; text-decoration: none; display: block; }
        .btn-retry { background: #ff4444; color: #fff; text-decoration: none; display: block; }

        #win-overlay { 
            position:absolute; top:0; left:0; width:100%; height:100%; 
            background: rgba(0,0,0,0.95); border-radius:20px; 
            display:none; flex-direction:column; justify-content:center; 
            align-items:center; z-index:20; 
        }
    </style>
</head>
<body>

    <audio id="sfx-thunder"><source src="https://www.soundjay.com/nature/sounds/thunder-8.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-ambient" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-15.mp3" type="audio/mpeg"></audio>

    <div class="storm-bg"></div>
    <div class="clouds"></div>
    <div class="lightning" id="lightning"></div>

    <div class="container">
        <div id="scr-login" class="card">
            <h1>ARENA ZEUS</h1>
            <p class="glitch-text">Ujian Kekuatan Dewa</p>
            <div style="margin-top: 20px;">
                <input type="text" id="name" placeholder="MASUKKAN NAMA">
                <input type="text" id="ticket" placeholder="KODE TIKET RAHASIA">
                <button class="btn btn-main" onclick="startArena()">MASUKI ARENA</button>
            </div>
        </div>

        <div id="scr-game" class="card" style="display:none">
            <div id="win-overlay">
                <lottie-player id="win-anim" src="" background="transparent" speed="1" style="width: 200px; height: 200px;" loop autoplay></lottie-player>
                <h2 id="final-msg" style="color:var(--gold); font-family:'Cinzel'">MENANG!</h2>
                <a id="btn-action" href="#" class="btn" style="text-align:center; width:80%">ACTION</a>
            </div>

            <div id="timer">60</div>
            <div id="prog" style="color:var(--cyan); font-weight: bold; margin-bottom: 5px;">LEVEL 1/3</div>
            <div id="quest" style="margin:15px 0; font-family:'Cinzel'; font-size: 1.2rem;"></div>
            
            <div class="box-row" id="clue-box"></div>
            
            <input type="text" id="ans" placeholder="KETIK JAWABAN..." autocomplete="off">
            <button class="btn btn-main" onclick="submitAns()">KIRIM JAWABAN</button>
            <div id="status-msg" style="margin-top:10px; font-weight: bold; height: 20px;"></div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx690qhxTVx5yMXdcqGNpXWPnrolAgHnbkKdcWZEvZN1mmNGYpWsCCPWGp7UVu2yLNNTQ/exec";
        const HADIAH_URL = "https://wa.me/62812345678";

        let gData = { soal:[], idx:0, time:60, timer:null, user:{n:"", t:"", ip:""}, logs:[] };

        // Ambil IP
        fetch('https://api.ipify.org?format=json').then(r => r.json()).then(d => gData.user.ip = d.ip);

        // Fungsi Petir & Suara
        function zap() {
            const l = document.getElementById('lightning');
            const sfx = document.getElementById('sfx-thunder');
            sfx.currentTime = 0;
            sfx.play().catch(() => {}); // Play sound
            l.classList.remove('strike'); 
            void l.offsetWidth; 
            l.classList.add('strike');
        }

        async function startArena() {
            const n = document.getElementById('name').value;
            const t = document.getElementById('ticket').value;
            if(!n || !t) return alert("Dewa tidak menerima hamba tanpa identitas!");

            const btn = document.querySelector('.btn-main');
            btn.innerText = "MENGUMPULKAN PETIR...";
            btn.disabled = true;

            // Mulai musik ambient saat klik pertama (kebijakan browser)
            document.getElementById('sfx-ambient').play().catch(() => {});

            try {
                const [authR, soalR] = await Promise.all([
                    fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: "validateAndLock", ticket: t, nama: n }) }),
                    fetch(SCRIPT_URL + "?action=getSoal")
                ]);
                
                const auth = await authR.json();
                if(!auth.valid) { 
                    alert("Tiket tidak sah atau sudah hangus!"); 
                    location.reload(); 
                    return; 
                }

                gData.soal = await soalR.json();
                gData.user.n = n; gData.user.t = t;
                
                zap();
                document.getElementById('scr-login').style.display = 'none';
                document.getElementById('scr-game').style.display = 'block';
                render();
            } catch(e) { 
                alert("Gangguan koneksi dari Olympus!"); 
                btn.disabled = false;
                btn.innerText = "MASUKI ARENA";
            }
        }

        function render() {
            if(gData.idx >= 3) return endLevel("MENANG");
            const s = gData.soal[gData.idx];
            document.getElementById('quest').innerText = s.pertanyaan;
            document.getElementById('prog').innerText = `LEVEL ${gData.idx+1}/3`;
            
            const cb = document.getElementById('clue-box');
            cb.innerHTML = "";
            s.clue.split(' ').forEach(l => cb.innerHTML += `<div class="letter-box">${l}</div>`);
            
            gData.time = 60;
            document.getElementById('timer').innerText = gData.time;
            clearInterval(gData.timer);
            gData.timer = setInterval(() => {
                gData.time--;
                document.getElementById('timer').innerText = gData.time;
                if(gData.time <= 0) { clearInterval(gData.timer); endLevel("KALAH"); }
            }, 1000);
        }

        function submitAns() {
            const u = document.getElementById('ans').value.toUpperCase().trim();
            const s = gData.soal[gData.idx];
            const msg = document.getElementById('status-msg');

            if(!u) return;

            gData.logs.push({ q: s.pertanyaan, a: u });

            if(u === s.jawaban.toUpperCase()) {
                zap();
                msg.innerHTML = "<span style='color:#00ff88'>KEKUATANMU TERBUKTI!</span>";
                setTimeout(() => { 
                    gData.idx++; 
                    document.getElementById('ans').value = "";
                    msg.innerText = "";
                    render(); 
                }, 1000);
            } else {
                msg.innerHTML = "<span style='color:#ff4444'>SALAH! COBA LAGI!</span>";
                setTimeout(() => msg.innerText = "", 1500);
            }
        }

        async function endLevel(hasil) {
            clearInterval(gData.timer);
            const ov = document.getElementById('win-overlay');
            const anim = document.getElementById('win-anim');
            const msg = document.getElementById('final-msg');
            const btn = document.getElementById('btn-action');

            ov.style.display = 'flex';
            
            fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({
                action: "finishLog", nama: gData.user.n, ticket: gData.user.t, ip: gData.user.ip,
                logs: gData.logs, hasil: hasil
            })});

            if(hasil === "MENANG") {
                zap();
                anim.src = "https://assets10.lottiefiles.com/packages/lf20_touohxv0.json";
                msg.innerText = "DIBERKATI ZEUS!";
                btn.innerText = "KLAIM HADIAH DEWA";
                btn.href = HADIAH_URL;
                btn.className = "btn btn-claim";
            } else {
                msg.innerText = "ANDA TIDAK LAYAK!";
                btn.innerText = "COBA LAGI";
                btn.onclick = () => location.reload();
                btn.className = "btn btn-retry";
            }
        }

        // Petir acak di background setiap beberapa detik
        setInterval(() => { if(Math.random() > 0.9) zap(); }, 5000);
    </script>
</body>
</html>
